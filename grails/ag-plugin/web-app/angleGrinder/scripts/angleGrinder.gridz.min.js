(function() {
    var gridz;
    gridz = angular.module("angleGrinder.gridz", [ "ngSanitize", "angleGrinder.common", "ui.select2" ]);
    gridz.run([ "$window", "agDateFilter", "agCurrencyFilter", function($window, agDateFilter, agCurrencyFilter) {
        $window.agDateFilter = agDateFilter;
        return $window.agCurrencyFilter = agCurrencyFilter;
    } ]);
    gridz.directive("agGrid", [ "$log", "$parse", "agGridDataLoader", "actionPopupHandler", "pathWithContext", "camelize", function($log, $parse, agGridDataLoader, actionPopupHandler, pathWithContext, camelize) {
        var link;
        link = function(scope, element, attrs, gridCtrl) {
            var alias, gridEl, initializeGrid, options, unregister;
            gridEl = element.find("table.gridz");
            alias = attrs.agGridName;
            if (alias) {
                $parse(alias).assign(scope, gridCtrl);
            }
            options = $parse(attrs.agGrid)(scope);
            if (!options) {
                throw new Error("undefined grid options");
            }
            if (attrs.agGridColModel) {
                options.colModel = angular.fromJson(attrs.agGridColModel);
            }
            scope.$on("$destroy", function() {
                $log.debug("[agGrid] destroying the grid", gridEl);
                return gridEl.jqGrid("GridDestroy");
            });
            initializeGrid = function() {
                $log.debug("[agGrid] initializing '" + alias + "' with", options);
                if (options.url == null && options.path != null) {
                    options.url = pathWithContext(options.path);
                }
                if (options.datatype === void 0 || options.datatype === null) {
                    options.datatype = agGridDataLoader(options.url, gridCtrl);
                }
                if (options.pager !== false) {
                    options.pager = element.find(".gridz-pager").attr("id") || "gridz-pager";
                }
                gridEl.gridz(options);
                return actionPopupHandler(gridEl, scope);
            };
            if (element.is(":visible")) {
                return initializeGrid();
            } else {
                $log.info("grid is not visible:", alias);
                return unregister = scope.$watch(function() {
                    if (!element.is(":visible")) {
                        return;
                    }
                    initializeGrid();
                    return unregister();
                });
            }
        };
        return {
            "restrict": "A",
            "require": "agGrid",
            "controller": "AgGridCtrl",
            "template": '<table class="gridz"></table>\n<div class="gridz-pager"></div>',
            "compile": function(element, attrs) {
                var id;
                id = attrs.agGridName != null ? camelize(attrs.agGridName) : "gridz";
                element.find("table.gridz").attr("id", id);
                element.find("div.gridz-pager").attr("id", "" + id + "-pager");
                return {
                    "post": link
                };
            }
        };
    } ]);
}).call(this);

(function() {
    var AgGridCtrl, gridz, __hasProp = {}.hasOwnProperty, __extends = function(child, parent) {
        for (var key in parent) {
            if (__hasProp.call(parent, key)) child[key] = parent[key];
        }
        function ctor() {
            this.constructor = child;
        }
        ctor.prototype = parent.prototype;
        child.prototype = new ctor();
        child.__super__ = parent.prototype;
        return child;
    };
    gridz = angular.module("angleGrinder.gridz");
    AgGridCtrl = function(_super) {
        __extends(AgGridCtrl, _super);
        function AgGridCtrl() {
            return AgGridCtrl.__super__.constructor.apply(this, arguments);
        }
        AgGridCtrl.register(gridz);
        AgGridCtrl.inject("$rootScope", "$element", "$q", "hasSearchFilters", "flatten", "xlsData");
        AgGridCtrl.prototype.getGridEl = function() {
            return this.gridEl || (this.gridEl = this.$element.find("table.gridz"));
        };
        AgGridCtrl.prototype.getGridId = function() {
            return this.getGridEl().attr("id");
        };
        AgGridCtrl.prototype.getSelectedRowIds = function() {
            return this.getParam("selarrrow");
        };
        AgGridCtrl.prototype.getRowData = function(rowId) {
            if (rowId == null) {
                rowId = null;
            }
            return this.getGridEl().getRowData(rowId);
        };
        AgGridCtrl.prototype.addJSONData = function(data) {
            this.getGridEl().get(0).addJSONData(data);
            return this.$rootScope.$broadcast("gridz:loadComplete", data);
        };
        AgGridCtrl.prototype.reload = function() {
            var deferred, unregister;
            deferred = this.$q.defer();
            unregister = this.$rootScope.$on("gridz:loadComplete", function(_, data) {
                deferred.resolve(data);
                return unregister();
            });
            this.getGridEl().trigger("reloadGrid");
            return deferred.promise;
        };
        AgGridCtrl.prototype.getParam = function(name) {
            return this.getGridEl().getGridParam(name);
        };
        AgGridCtrl.prototype.setParam = function(params) {
            return this.getGridEl().setGridParam(params);
        };
        AgGridCtrl.prototype.updateRow = function(id, data) {
            var diff, flatData, key, prevData, restrictedColumns, _i, _len;
            flatData = this.flatten(data);
            prevData = this.getRowData(id);
            if (prevData != null) {
                diff = _.difference(_.keys(prevData), _.keys(flatData));
                restrictedColumns = function(key) {
                    return !key.match(/^-/);
                };
                diff = diff.filter(restrictedColumns);
                for (_i = 0, _len = diff.length; _i < _len; _i++) {
                    key = diff[_i];
                    flatData[key] = null;
                }
            }
            this.getGridEl().setRowData(id, flatData);
            return this.flashOnSuccess(id);
        };
        AgGridCtrl.prototype.addRow = function(id, data, position) {
            if (position == null) {
                position = "first";
            }
            this.getGridEl().addRowData(id, this.flatten(data), position);
            this.$rootScope.$broadcast("gridz:rowAdded", id, data);
            return this.flashOnSuccess(id);
        };
        AgGridCtrl.prototype.hasRow = function(id) {
            return !!this.getGridEl().getInd(id);
        };
        AgGridCtrl.prototype.getIds = function() {
            return this.getGridEl().getDataIDs();
        };
        AgGridCtrl.prototype.getCurrentPage = function() {
            return this.getParam("page");
        };
        AgGridCtrl.prototype.getTotalRecords = function() {
            return this.getParam("records");
        };
        AgGridCtrl.prototype.getPageSize = function() {
            return this.getParam("rowNum");
        };
        AgGridCtrl.prototype.getTotalPages = function() {
            return Math.ceil(this.getTotalRecords() / this.getPageSize());
        };
        AgGridCtrl.prototype.isFirstPage = function() {
            var page;
            page = this.getCurrentPage();
            return page === 1;
        };
        AgGridCtrl.prototype.isLastPage = function() {
            var page;
            page = this.getCurrentPage();
            return page === this.getTotalPages();
        };
        AgGridCtrl.prototype.prevPage = function() {
            var page;
            if (this.isFirstPage()) {
                return this.lastPage();
            }
            page = this.getCurrentPage();
            return this.loadPage(page - 1);
        };
        AgGridCtrl.prototype.nextPage = function() {
            var page;
            if (this.isLastPage()) {
                return this.firstPage();
            }
            page = this.getCurrentPage();
            return this.loadPage(page + 1);
        };
        AgGridCtrl.prototype.firstPage = function() {
            return this.loadPage(1);
        };
        AgGridCtrl.prototype.lastPage = function() {
            return this.loadPage(this.getTotalPages());
        };
        AgGridCtrl.prototype.loadPage = function(page) {
            this.setParam({
                "page": page
            });
            return this.reload();
        };
        AgGridCtrl.prototype.saveRow = function(id, data) {
            if (this.hasRow(id)) {
                return this.updateRow(id, data);
            } else {
                return this.addRow(id, data);
            }
        };
        AgGridCtrl.prototype.removeRow = function(id) {
            return this.flashOnSuccess(id, function(_this) {
                return function() {
                    return _this.getGridEl().delRowData(id);
                };
            }(this));
        };
        AgGridCtrl.prototype.search = function(filters) {
            var deferred, params, promise;
            deferred = this.$q.defer();
            params = {
                "search": this.hasSearchFilters(filters),
                "postData": {
                    "filters": JSON.stringify(filters)
                }
            };
            this.setParam(params);
            promise = this.reload();
            promise.then(function() {
                return deferred.resolve(filters);
            });
            return deferred.promise;
        };
        AgGridCtrl.prototype.isColumnHidden = function(columnId) {
            var column;
            column = _.findWhere(this.getParam("colModel"), {
                "name": columnId
            });
            return column != null ? column.hidden : void 0;
        };
        AgGridCtrl.prototype.toggleColumn = function(columnId) {
            var showOrHide;
            showOrHide = this.isColumnHidden(columnId) ? "showCol" : "hideCol";
            this.getGridEl().jqGrid(showOrHide, columnId);
            return this._triggerResize();
        };
        AgGridCtrl.prototype.columnChooser = function(options) {
            if (options == null) {
                options = {};
            }
            options.done = function(_this) {
                return function(perm) {
                    var chosenColumns;
                    if (perm) {
                        _this.getGridEl().jqGrid("remapColumns", perm, true);
                    }
                    chosenColumns = _.map(_this._getColModel(), function(column) {
                        return _.pick(column, "name", "hidden");
                    });
                    return window.localStorage.setItem("gridz." + _this.getGridId() + ".chosenColumns", angular.toJson(chosenColumns));
                };
            }(this);
            return this.getGridEl().jqGrid("columnChooser", options);
        };
        AgGridCtrl.prototype.getXlsDataUri = function() {
            return this.xlsData(this.getGridId(), this.getSelectedRowIds());
        };
        AgGridCtrl.prototype._triggerResize = function() {
            return this.getGridEl().trigger("resize");
        };
        AgGridCtrl.prototype.flashOnSuccess = function(id, complete) {
            if (complete == null) {
                complete = angular.noop;
            }
            return this._flashRow(id, "#DFF0D8", complete);
        };
        AgGridCtrl.prototype.flashOnError = function(id, complete) {
            if (complete == null) {
                complete = angular.noop;
            }
            return this._flashRow(id, "#FF0000", complete);
        };
        AgGridCtrl.prototype._flashRow = function(id, color, complete) {
            var rowEl;
            if (color == null) {
                color = "#DFF0D8";
            }
            if (complete == null) {
                complete = angular.noop;
            }
            rowEl = $(this.getGridEl()[0].rows.namedItem(id));
            rowEl.css("background-color", color);
            rowEl.delay(250).fadeOut("medium", function() {
                return rowEl.css("background-color", "");
            });
            return rowEl.fadeIn("fast", function() {
                return complete();
            });
        };
        return AgGridCtrl;
    }(BaseCtrl);
}).call(this);

(function() {
    var gridz;
    gridz = angular.module("angleGrinder.gridz");
    gridz.service("agGridDataLoader", [ "$log", "$http", "$document", function($log, $http, $document) {
        return function(url, gridCtrl) {
            return function(params, loadingDivSelector) {
                var loadingEl, promise;
                promise = $http.get(url, {
                    "params": params
                });
                promise.then(function(response) {
                    $log.debug("[gridz] grid data loaded", gridCtrl, response);
                    return gridCtrl.addJSONData(response.data);
                });
                loadingEl = $document.find("#" + $.jgrid.jqID(loadingDivSelector));
                loadingEl.show();
                return promise["finally"](function() {
                    return loadingEl.hide();
                });
            };
        };
    } ]);
}).call(this);

(function() {
    var gridz;
    gridz = angular.module("angleGrinder.gridz");
    gridz.constant("rootPath", "/");
    gridz.directive("agGridPlaceholder", [ "$log", "$parse", "pathWithContext", "rootPath", function($log, $parse, pathWithContext, rootPath) {
        return {
            "restrict": "E",
            "scope": true,
            "link": function(scope, element, attrs) {
                scope.templateSrc = pathWithContext(attrs.src);
                scope.renderGrid = false;
                if (attrs.forceRenderGrid) {
                    scope.renderGrid = $parse(attrs.forceRenderGrid)(scope);
                }
                scope.showGrid = false;
                return scope.$on("$routeChangeSuccess", function(event, currentRoute) {
                    var msg, show;
                    show = currentRoute.originalPath === rootPath;
                    if (show) {
                        scope.renderGrid = show;
                    }
                    scope.showGrid = show;
                    msg = show ? "show grid" : "hide grid";
                    return $log.debug("[agGrid]", msg, currentRoute);
                });
            },
            "template": '<div ng-if="renderGrid">\n  <ng-include src="templateSrc" ng-show="showGrid"></ng-include>\n</div>'
        };
    } ]);
}).call(this);

(function() {
    var gridz;
    gridz = angular.module("angleGrinder.gridz");
    gridz.directive("agGridQuickSearch", [ function() {
        return {
            "restrict": "E",
            "scope": {
                "grid": "=for",
                "filters": "=?"
            },
            "link": function($scope) {
                if ($scope.filters == null) {
                    $scope.filters = {};
                }
                angular.extend($scope.filters, {
                    "quickSearch": ""
                });
                return $scope.search = function(filters) {
                    return $scope.grid.search(filters);
                };
            },
            "template": '<form class="navbar-search pull-right" name="quickSearch" ng-submit="search(filters)">\n  <input type="text" placeholder="quick search" class="search-query span2"\n         ng-model="filters.quickSearch"/>\n  <button ng-show="false" type="submit">Search</button>\n</form>'
        };
    } ]);
}).call(this);

(function() {
    var gridz;
    gridz = angular.module("angleGrinder.gridz");
    gridz.service("xlsTemplate", [ "$window", function($window) {
        return function(_arg) {
            var table, worksheet, _ref;
            _ref = _arg != null ? _arg : {
                "worksheet": "Worksheet"
            }, worksheet = _ref.worksheet, table = _ref.table;
            return $window.btoa(unescape(encodeURIComponent('<html xmlns:o="urn:schemas-microsoft-com:office:office"\n      xmlns:x="urn:schemas-microsoft-com:office:excel"\n      xmlns="http://www.w3.org/TR/REC-html40">\n  <head>\n  <!--[if gte mso 9]>\n  <xml>\n    <x:ExcelWorkbook>\n      <x:ExcelWorksheets>\n          <x:ExcelWorksheet>\n          <x:Name>' + worksheet + "</x:Name>\n          <x:WorksheetOptions>\n            <x:DisplayGridlines/>\n          </x:WorksheetOptions>\n        </x:ExcelWorksheet>\n      </x:ExcelWorksheets>\n    </x:ExcelWorkbook>\n  </xml>\n  <![endif]-->\n  </head>\n  <body>\n    <table>" + table + "</table>\n  </body>\n</html>")));
        };
    } ]);
    gridz.service("xlsData", [ "$document", "$sanitize", "xlsTemplate", function($document, $sanitize, xlsTemplate) {
        var buildTable, findGridEl, prepareHeading, prepareRows;
        findGridEl = function(gridId) {
            return $document.find("div#gbox_" + gridId);
        };
        prepareHeading = function(gridId) {
            var el, gridEl;
            gridEl = findGridEl(gridId);
            el = gridEl.find(".ui-jqgrid-hbox table").clone();
            el.find("th#" + gridId + "_cb").remove();
            el.find("th#" + gridId + "_-row_action_col").remove();
            el.find("th").each(function(index, th) {
                var thEl;
                thEl = $(th);
                return thEl.html(thEl.text().trim());
            });
            return el.html();
        };
        prepareRows = function(gridId, selectedIds) {
            var el, gridEl;
            gridEl = findGridEl(gridId);
            el = gridEl.find("#" + gridId).clone();
            el.find("tr.jqgfirstrow").remove();
            el.find("td[aria-describedby='" + gridId + "_cb']").remove();
            el.find("td[aria-describedby='" + gridId + "_-row_action_col']").remove();
            el.find("td a").contents().unwrap();
            if (selectedIds.length > 0) {
                el.find("tr").each(function(index, tr) {
                    var id, rowEl;
                    rowEl = $(tr);
                    id = rowEl.attr("id");
                    if (!_.include(selectedIds, id)) {
                        return el.find("tr#" + id).remove();
                    }
                });
            }
            return el.html();
        };
        buildTable = function(gridId, selectedRows) {
            var attr, attrsToRemove, resultEl, _i, _len;
            resultEl = angular.element("<div></div>");
            resultEl.append(prepareHeading(gridId));
            resultEl.append(prepareRows(gridId, selectedRows));
            attrsToRemove = [ "id", "class", "style", "title", "aria-describedby", "aria-labelledby", "aria-multiselectable", "role", "tabindex", "sort" ];
            for (_i = 0, _len = attrsToRemove.length; _i < _len; _i++) {
                attr = attrsToRemove[_i];
                resultEl.find("*").removeAttr(attr);
            }
            return $sanitize(resultEl.html());
        };
        return function(gridId, selectedRows) {
            var data;
            if (selectedRows == null) {
                selectedRows = [];
            }
            data = xlsTemplate({
                "table": buildTable(gridId, selectedRows),
                "worksheet": "Grid export"
            });
            return "data:application/vnd.ms-excel;base64," + data;
        };
    } ]);
    gridz.directive("agGridXlsExport", [ "$window", function($window) {
        return {
            "restrict": "A",
            "scope": {
                "grid": "=agGridXlsExport"
            },
            "link": function(scope, element) {
                return element.on("click", function(event) {
                    var dataUri;
                    event.preventDefault();
                    dataUri = scope.grid.getXlsDataUri();
                    return $window.location.href = dataUri;
                });
            }
        };
    } ]);
}).call(this);

(function() {
    var gridz;
    gridz = angular.module("angleGrinder.gridz");
    gridz.factory("actionPopupHandler", [ "$log", function($log) {
        return function(gridEl, scope) {
            var handleAction;
            handleAction = function(action, id) {
                if (scope[action] != null) {
                    $log.info("Trigger '" + action + "' for row '" + id + "'");
                    return scope.$apply(function() {
                        return scope[action](id);
                    });
                } else {
                    return $log.warn("`$scope." + action + "` is not defined");
                }
            };
            gridEl.on("showAction", function(event, id) {
                event.preventDefault();
                return handleAction("showRecord", id);
            });
            gridEl.on("editAction", function(event, id) {
                event.preventDefault();
                return handleAction("editRecord", id);
            });
            gridEl.on("deleteAction", function(event, id) {
                event.preventDefault();
                return handleAction("deleteRecord", id);
            });
            return gridEl.on("click", "a.editActionLink", function(event) {
                var id;
                event.preventDefault();
                id = $(this).parents("tr:first").attr("id");
                return handleAction("editRecord", id);
            });
        };
    } ]);
}).call(this);

(function() {
    var gridz;
    gridz = angular.module("angleGrinder.gridz");
    gridz.value("flatten", function(target, opts) {
        var delimiter, getKey, output, step;
        if (opts == null) {
            opts = {
                "delimiter": "."
            };
        }
        delimiter = opts.delimiter;
        getKey = function(key, prev) {
            if (prev) {
                return prev + delimiter + key;
            } else {
                return key;
            }
        };
        step = function(object, prev) {
            return angular.forEach(Object.keys(object), function(key) {
                var isArray, isObject, type;
                isArray = opts.safe && object[key] instanceof Array;
                type = Object.prototype.toString.call(object[key]);
                isObject = type === "[object Object]" || type === "[object Array]";
                if (!isArray && isObject) {
                    return step(object[key], getKey(key, prev));
                }
                return output[getKey(key, prev)] = object[key];
            });
        };
        output = {};
        step(target);
        return output;
    });
}).call(this);

(function() {
    var gridz;
    gridz = angular.module("angleGrinder.gridz");
    gridz.value("hasSearchFilters", function(filters) {
        var value, _;
        for (_ in filters) {
            value = filters[_];
            if (value == null) {
                continue;
            }
            if (typeof value === "string") {
                if ($.trim(value) !== "") {
                    return true;
                }
            } else {
                return true;
            }
        }
        return false;
    });
    gridz.directive("agSearchButton", function() {
        return {
            "restrict": "E",
            "replace": true,
            "template": '<button type="submit" ng-click="advancedSearch(filters)" ng-disabled="searching" class="btn btn-info">\n  <i class="icon-search icon-white"></i> Search<span ng-show="searching">...</span>\n</button>'
        };
    });
    gridz.directive("agResetSearchButton", function() {
        return {
            "restrict": "E",
            "replace": true,
            "template": '<button type="button" ng-click="resetSearch(filters)" ng-disabled="searching" class="btn">\n  <i class="icon-remove"></i> Reset<span ng-show="searching">...</span>\n</button>'
        };
    });
    gridz.directive("agSearchForm", [ "$log", function($log) {
        return {
            "restrict": "A",
            "scope": true,
            "require": "^form",
            "link": function(scope, element, attrs, form) {
                return scope.searchForm = form;
            },
            "controller": [ "$scope", "$parse", "$attrs", function($scope, $parse, $attrs) {
                var gridSearch;
                $scope.searching = false;
                gridSearch = function(filters) {
                    var grid, promise;
                    if (filters == null) {
                        filters = {};
                    }
                    grid = $parse($attrs.agSearchForm)($scope);
                    if (grid == null) {
                        $log.warn("[gridz] grid is not defined");
                        return;
                    }
                    promise = grid.search(filters);
                    $scope.searching = true;
                    promise["finally"](function() {
                        return $scope.searching = false;
                    });
                    return promise;
                };
                $scope.advancedSearch = function(filters) {
                    var form;
                    if (filters == null) {
                        filters = {};
                    }
                    form = $scope.searchForm;
                    if (form && form.$invalid) {
                        return $log.info("[gridz] advanced search form is invalid", form);
                    }
                    return gridSearch(filters);
                };
                return $scope.resetSearch = function(filters) {
                    var defaultFilters;
                    if (filters == null) {
                        filters = {};
                    }
                    defaultFilters = $scope.defaultFilters || {};
                    angular.copy(defaultFilters, filters);
                    return gridSearch(filters);
                };
            } ]
        };
    } ]);
}).call(this);

(function() {
    var gridz;
    gridz = angular.module("angleGrinder.gridz");
    gridz.directive("agSelect2", [ "$rootScope", "$compile", "$log", "pathWithContext", function($rootScope, $compile, $log, pathWithContext) {
        return {
            "restrict": "E",
            "replace": true,
            "transclude": true,
            "scope": {
                "selectOptions": "=",
                "ngModel": "="
            },
            "compile": function(element, attrs, transclude) {
                var resultTemplate, scope;
                resultTemplate = null;
                scope = $rootScope.$new();
                transclude(scope, function(clone) {
                    var _i, _len, _results;
                    _results = [];
                    for (_i = 0, _len = clone.length; _i < _len; _i++) {
                        element = clone[_i];
                        if (element instanceof HTMLElement && element.getAttribute("ag-select2-result") != null) {
                            resultTemplate = element.outerHTML;
                            break;
                        } else {
                            _results.push(void 0);
                        }
                    }
                    return _results;
                });
                return {
                    "pre": function(scope, element, attrs) {
                        var options;
                        options = angular.copy(scope.selectOptions || {});
                        scope.options = options;
                        if (options.minimumInputLength == null) {
                            options.minimumInputLength = 1;
                        }
                        if (attrs.selectMinimumInputLength != null) {
                            options.minimumInputLength = parseInt(attrs.selectMinimumInputLength);
                        }
                        if (options.width == null) {
                            options.width = "resolve";
                        }
                        if (options.ajax == null && attrs.selectAjaxUrl != null) {
                            options.ajax = {
                                "url": pathWithContext(attrs.selectAjaxUrl),
                                "data": function(term, page) {
                                    return {
                                        "q": term,
                                        "max": 20,
                                        "page": page,
                                        "sort": "name",
                                        "order": "asc"
                                    };
                                },
                                "results": function(data, page) {
                                    var more;
                                    more = page < data.total;
                                    return {
                                        "results": data.rows,
                                        "more": more
                                    };
                                }
                            };
                            options.ajax.quietMillis = 500;
                            if (attrs.selectAjaxQuietMillis != null) {
                                options.ajax.quietMillis = parseInt(attrs.selectAjaxQuietMillis);
                            }
                        }
                        if (resultTemplate != null) {
                            if (options.formatResult == null) {
                                options.formatResult = function(item) {
                                    options = {
                                        "interpolate": /\{\{(.+?)\}\}/g
                                    };
                                    return angular.element(_.template(resultTemplate, {
                                        "item": item
                                    }, options));
                                };
                            }
                        }
                        if (options.formatSelection == null) {
                            options.formatSelection = function(item) {
                                return item.name;
                            };
                        }
                        return $log.debug("[forms] initializing AgSelect2 component", scope.options);
                    }
                };
            },
            "template": '<div>\n  <input ui-select2="options" multiple ng-model="ngModel" type="hidden"/>\n  <ag-select2-open></ag-select2-open>\n</div>'
        };
    } ]);
    gridz.directive("agSelect2Open", function() {
        return {
            "restrict": "E",
            "replace": true,
            "scope": true,
            "controller": [ "$scope", "$element", function($scope, $element) {
                return $scope.openSelect2 = function() {
                    var selectEl;
                    selectEl = $element.parent().find(".select2-container");
                    selectEl.select2("open");
                };
            } ],
            "template": '<button class="btn open-select2" type="button" ng-click="openSelect2()">\n  <i class="icon-search"></i>\n</button>'
        };
    });
}).call(this);

(function() {
    var gridz;
    gridz = angular.module("angleGrinder.gridz");
    gridz.controller("gridPagerCtrlMixin", [ "$log", "$scope", "$parse", "$location", "$q", "gridName", "currentId", "path", function($log, $scope, $parse, $location, $q, gridName, currentId, path) {
        var currIdGetter, currIdSetter, getCurrent, getGrid, getGridIds, nextGridPage, prevGridPage;
        currIdGetter = $parse(currentId);
        currIdSetter = currIdGetter.assign;
        $scope.$watch(currentId, function(id, oldId) {
            if (id == null) {
                return;
            }
            if (id === oldId) {
                return;
            }
            return $location.path(path.replace(":id", id));
        });
        getGrid = function() {
            return $parse(gridName)($scope);
        };
        getGridIds = function() {
            return getGrid().getIds();
        };
        prevGridPage = function() {
            var deferred, promise;
            deferred = $q.defer();
            promise = getGrid().prevPage();
            promise.then(function() {
                var ids;
                ids = getGridIds();
                $log.debug("[agGrid] previous page was loaded", ids);
                return deferred.resolve(ids);
            });
            return deferred.promise;
        };
        nextGridPage = function() {
            var deferred, promise;
            deferred = $q.defer();
            promise = getGrid().nextPage();
            promise.then(function() {
                var ids;
                ids = getGridIds();
                $log.debug("[agGrid] next page was loaded", ids);
                return deferred.resolve(ids);
            });
            return deferred.promise;
        };
        getCurrent = function() {
            var ids;
            ids = getGridIds();
            return [ ids, ids.indexOf(currIdGetter($scope).toString()) ];
        };
        this.show = function() {
            return getGrid() != null;
        };
        this.hasPrevRow = function() {
            var ids, indx, _ref;
            _ref = getCurrent(), ids = _ref[0], indx = _ref[1];
            if (!getGrid().isFirstPage()) {
                return true;
            }
            return indx !== 0;
        };
        this.hasNextRow = function() {
            var ids, indx, _ref;
            _ref = getCurrent(), ids = _ref[0], indx = _ref[1];
            if (!getGrid().isLastPage()) {
                return true;
            }
            return indx !== ids.length - 1;
        };
        this.prevRow = function() {
            var ids, indx, _ref;
            _ref = getCurrent(), ids = _ref[0], indx = _ref[1];
            if (indx > 0) {
                return currIdSetter($scope, ids[indx - 1]);
            } else {
                return prevGridPage().then(function(ids) {
                    return currIdSetter($scope, ids[ids.length - 1]);
                });
            }
        };
        this.nextRow = function() {
            var ids, indx, _ref;
            _ref = getCurrent(), ids = _ref[0], indx = _ref[1];
            if (indx < ids.length - 1) {
                return currIdSetter($scope, ids[indx + 1]);
            } else {
                return nextGridPage().then(function(ids) {
                    return currIdSetter($scope, ids[0]);
                });
            }
        };
        return this;
    } ]);
}).call(this);