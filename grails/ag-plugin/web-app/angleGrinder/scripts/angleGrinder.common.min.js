(function() {
    var common, __slice = [].slice;
    common = angular.module("angleGrinder.common", [ "ui.bootstrap.modal", "angleGrinder.resources", "duScroll" ]);
    common.config([ "$localeProvider", "$provide", function($localeProvider, $provide) {
        var defaultLocale;
        defaultLocale = $localeProvider.$get();
        angular.extend(defaultLocale.NUMBER_FORMATS.PATTERNS[1], {
            "negPre": "-",
            "negSuf": ""
        });
        return $provide.value("$locale", defaultLocale);
    } ]);
    common.factory("pendingRequests", [ "$http", function($http) {
        var pendingRequests;
        pendingRequests = function() {
            return pendingRequests.any();
        };
        pendingRequests.any = function() {
            return pendingRequests["for"]("GET", "POST", "PUT", "PATCH", "DELETE");
        };
        pendingRequests["for"] = function() {
            var httpMethods, requests;
            httpMethods = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
            requests = _.filter($http.pendingRequests, function(request) {
                return _.contains(httpMethods, request.method);
            });
            return requests.length > 0;
        };
        return pendingRequests;
    } ]);
    common.value("isEmpty", function(str) {
        return _.isString(str) && _.isEmpty(str);
    });
    common.service("isFalsy", [ "isEmpty", function(isEmpty) {
        return function(value) {
            if (_.isNaN(value)) {
                return true;
            }
            if (isEmpty(value)) {
                return true;
            }
            if (_.isNull(value)) {
                return true;
            }
            if (_.isUndefined(value)) {
                return true;
            }
            if (value === false) {
                return true;
            }
            return false;
        };
    } ]);
    common.value("camelize", function(str) {
        return str.replace(/(\-|\.|_|\s)+(.)?/g, function(match, p1, p2) {
            if (p2) {
                return p2.toUpperCase();
            } else {
                return "";
            }
        });
    });
}).call(this);

(function() {
    var app;
    app = angular.module("angleGrinder.common");
    app.directive("agBackButton", [ "$window", function($window) {
        return {
            "restrict": "A",
            "link": function(scope, element) {
                return element.on("click", function(event) {
                    event.preventDefault();
                    return $window.history.back();
                });
            }
        };
    } ]);
}).call(this);

(function() {
    var app;
    app = angular.module("angleGrinder.common");
    app.provider("agCurrencyFilter", function() {
        var defaultFormat, defaultSymbol;
        defaultSymbol = "$";
        defaultFormat = "<%= symbol %><%= amount %>";
        return {
            "setDefaultSymbol": function(symbol) {
                return defaultSymbol = symbol;
            },
            "setDefaultFormat": function(format) {
                return defaultFormat = format;
            },
            "$get": [ "$filter", "isFalsy", function($filter, isFalsy) {
                return function(amount, symbol) {
                    var formattedAmount;
                    if (symbol == null) {
                        symbol = defaultSymbol;
                    }
                    if (isFalsy(amount)) {
                        return "";
                    }
                    formattedAmount = $filter("currency")(amount, "");
                    return _.template(defaultFormat)({
                        "amount": formattedAmount,
                        "symbol": symbol
                    });
                };
            } ]
        };
    });
    app.filter("agCurrencyOrZero", [ "agCurrencyFilter", function(agCurrencyFilter) {
        return function(val) {
            if (typeof val === "undefined" || val === null || val === "null" || val === "") {
                val = 0;
            }
            return agCurrencyFilter(val);
        };
    } ]);
}).call(this);

(function() {
    var app;
    app = angular.module("angleGrinder.common");
    app.provider("agDateFilter", function() {
        var defaultFormat;
        defaultFormat = "MMM DD, YYYY";
        return {
            "setDefaultFormat": function(format) {
                return defaultFormat = format;
            },
            "$get": [ "$filter", "isFalsy", function($filter, isFalsy) {
                return function(date, useTimeZone, format) {
                    if (useTimeZone == null) {
                        useTimeZone = false;
                    }
                    if (format == null) {
                        format = defaultFormat;
                    }
                    if (isFalsy(date)) {
                        return "";
                    }
                    return moment(date).format(format);
                };
            } ]
        };
    });
    app.filter("localDate", [ "isFalsy", "agDate", function(isFalsy, agDate) {
        return function(input) {
            if (isFalsy(input)) {
                return "";
            }
            return moment(input).format(agDate.getViewFormat());
        };
    } ]);
    app.filter("localDateTime", [ "isFalsy", function(isFalsy) {
        return function(input) {
            if (isFalsy(input)) {
                return "";
            }
            return moment(input).format("MM/DD/YYYY h:mma");
        };
    } ]);
}).call(this);

(function() {
    var app;
    app = angular.module("angleGrinder.common");
    app.provider("agDateTimeFilter", function() {
        var defaultFormat;
        defaultFormat = "DD MMM YYYY HH:mm A";
        return {
            "setDefaultFormat": function(format) {
                return defaultFormat = format;
            },
            "$get": [ "$filter", function($filter) {
                return function(date, format) {
                    if (format == null) {
                        format = defaultFormat;
                    }
                    return $filter("agDate")(date, true, format);
                };
            } ]
        };
    });
}).call(this);

(function() {
    var app;
    app = angular.module("angleGrinder.common");
    app.filter("checkMark", function() {
        return function(input, options) {
            if (options == null) {
                options = {};
            }
            if (input) {
                if (options.hideTruth) {
                    return "";
                }
                return "\u2713";
            } else {
                if (options.hideFalse) {
                    return "";
                }
                return "\u2718";
            }
        };
    });
}).call(this);

(function() {
    var app, __slice = [].slice;
    app = angular.module("angleGrinder.common");
    app.service("deepPick", function() {
        var getDeep, setDeep;
        getDeep = function(obj, path) {
            var key, keys, _i, _len;
            keys = path.split(".");
            for (_i = 0, _len = keys.length; _i < _len; _i++) {
                key = keys[_i];
                obj = obj[key];
                if (obj === void 0) {
                    return;
                }
            }
            return obj;
        };
        setDeep = function(obj, path, value) {
            var i, key, keys, n;
            keys = path.split(".");
            i = 0;
            n = keys.length;
            n--;
            while (i < n) {
                key = keys[i++];
                obj = obj[key] = _.isObject(obj[key]) ? obj[key] : {};
            }
            return obj[keys[i]] = value;
        };
        return function() {
            var keys, obj, path, result, value, _i, _len;
            obj = arguments[0], keys = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
            result = new Object();
            for (_i = 0, _len = keys.length; _i < _len; _i++) {
                path = keys[_i];
                value = getDeep(obj, path);
                if (value !== void 0) {
                    setDeep(result, path, value);
                }
            }
            return result;
        };
    });
}).call(this);

(function() {
    var app;
    app = angular.module("angleGrinder.common");
    app.filter("newLines", function() {
        return function(text) {
            if (!angular.isString(text)) {
                return text;
            }
            return text.replace(/\n/g, "<br />");
        };
    });
}).call(this);

(function() {
    var app;
    app = angular.module("angleGrinder.common");
    app.value("urlBuilder", function(path, params) {
        var queryString;
        if (params == null) {
            params = {};
        }
        queryString = _.chain(params).map(function(value, key) {
            return "" + key + "=" + value;
        }).join("&").value();
        return _.filter([ path, queryString ], function(part) {
            return part.length > 0;
        }).join("?");
    });
    app.provider("pathWithContext", function() {
        var contextPath, sanitizePath;
        contextPath = "/";
        sanitizePath = function(path) {
            if (path.length === 0) {
                return "/";
            }
            return "/" + path.replace(/\/*$/, "").replace(/^\/*/, "");
        };
        return {
            "setContextPath": function(path) {
                contextPath = sanitizePath(path);
            },
            "$get": [ "urlBuilder", function(urlBuilder) {
                return function(path, params) {
                    if (params == null) {
                        params = {};
                    }
                    path = _.filter([ contextPath, sanitizePath(path) ], function(part) {
                        return part != null && part !== "/";
                    }).join("");
                    return urlBuilder(path, params);
                };
            } ]
        };
    });
    app.filter("withContext", [ "pathWithContext", function(pathWithContext) {
        return function(path) {
            return pathWithContext(path);
        };
    } ]);
}).call(this);

(function() {
    var ConfirmationDialogCtrl, app, __hasProp = {}.hasOwnProperty, __extends = function(child, parent) {
        for (var key in parent) {
            if (__hasProp.call(parent, key)) child[key] = parent[key];
        }
        function ctor() {
            this.constructor = child;
        }
        ctor.prototype = parent.prototype;
        child.prototype = new ctor();
        child.__super__ = parent.prototype;
        return child;
    };
    app = angular.module("angleGrinder.common");
    ConfirmationDialogCtrl = function(_super) {
        __extends(ConfirmationDialogCtrl, _super);
        function ConfirmationDialogCtrl() {
            return ConfirmationDialogCtrl.__super__.constructor.apply(this, arguments);
        }
        ConfirmationDialogCtrl.register(app, "ConfirmationDialogCtrl");
        ConfirmationDialogCtrl.inject("$scope", "$modalInstance", "$log", "options", "defer");
        ConfirmationDialogCtrl.prototype.close = function(confirmed) {
            this.$log.info("[ag] closing confirmation dialog", confirmed);
            this.$modalInstance.close(confirmed);
            return this.defer.resolve(confirmed);
        };
        return ConfirmationDialogCtrl;
    }(BaseCtrl);
    app.service("confirmationDialog", [ "$uibModal", "$log", "$q", function($modal, $log, $q) {
        return {
            "open": function(options) {
                var defer;
                if (options == null) {
                    options = {};
                }
                if (angular.isString(options)) {
                    options = {
                        "message": options
                    };
                }
                if (options.message == null) {
                    options.message = "Are you sure?";
                }
                if (options.cancelLabel == null) {
                    options.cancelLabel = "Cancel";
                }
                if (options.okLabel == null) {
                    options.okLabel = "Ok";
                }
                $log.info("[ag] opening confirmation dialog", options);
                defer = $q.defer();
                $modal.open({
                    "keyboard": false,
                    "backdrop": "static",
                    "controller": "ConfirmationDialogCtrl as ctrl",
                    "template": '<div class="modal-body">{{ctrl.options.message}}</div>\n\n<div class="modal-footer">\n  <button class="btn" ng-click="ctrl.close(false)">{{ctrl.options.cancelLabel}}</button>\n  <button class="btn btn-primary" ng-click="ctrl.close(true)">{{ctrl.options.okLabel}}</button>\n</div>',
                    "resolve": {
                        "options": function() {
                            return options;
                        },
                        "defer": function() {
                            return defer;
                        }
                    }
                });
                return defer.promise;
            }
        };
    } ]);
}).call(this);

(function() {
    var NotificationDialog, NotificationDialogCtrl, app, __hasProp = {}.hasOwnProperty, __extends = function(child, parent) {
        for (var key in parent) {
            if (__hasProp.call(parent, key)) child[key] = parent[key];
        }
        function ctor() {
            this.constructor = child;
        }
        ctor.prototype = parent.prototype;
        child.prototype = new ctor();
        child.__super__ = parent.prototype;
        return child;
    };
    app = angular.module("angleGrinder.common");
    NotificationDialogCtrl = function(_super) {
        __extends(NotificationDialogCtrl, _super);
        function NotificationDialogCtrl() {
            return NotificationDialogCtrl.__super__.constructor.apply(this, arguments);
        }
        NotificationDialogCtrl.register(app, "NotificationDialogCtrl");
        NotificationDialogCtrl.inject("$scope", "$modalInstance", "$log", "options");
        NotificationDialogCtrl.prototype.initialize = function() {
            return this.expose(this.$scope, "options", "close");
        };
        NotificationDialogCtrl.prototype.close = function() {
            this.$log.info("Closing notification dialog");
            return this.$modalInstance.close();
        };
        return NotificationDialogCtrl;
    }(BaseCtrl);
    app.run([ "$templateCache", function($templateCache) {
        return $templateCache.put("templates/dialogs/notification.html", '<div class="modal-body">{{options.message}}</div>\n\n<div class="modal-footer">\n  <button class="btn btn-primary" ng-click="close()">{{options.okLabel}}</button>\n</div>');
    } ]);
    NotificationDialog = function() {
        NotificationDialog.$inject = [ "$uibModal", "$log" ];
        function NotificationDialog($modal, $log) {
            this.$modal = $modal;
            this.$log = $log;
        }
        NotificationDialog.prototype.open = function(options) {
            if (angular.isString(options)) {
                options = {
                    "message": options
                };
            }
            if (options.okLabel == null) {
                options.okLabel = "Ok";
            }
            this.$log.info("Opening notification dialog, message:", options.message);
            return this.$modal.open({
                "templateUrl": "templates/dialogs/notification.html",
                "controller": "NotificationDialogCtrl",
                "keyboard": false,
                "backdrop": "static",
                "resolve": {
                    "options": function() {
                        return options;
                    }
                }
            });
        };
        return NotificationDialog;
    }();
    app.service("notificationDialog", NotificationDialog);
}).call(this);

(function() {
    var app;
    app = angular.module("angleGrinder.common");
    app.directive("addEmptyOption", function() {
        return {
            "restrict": "A",
            "link": function(scope, element, attrs) {
                element.append("<option value></option>");
                return scope.$watch(attrs.ngModel, function(newVal, oldVal) {
                    if (!newVal) {
                        return angular.element(element.find("[value='']")[0]).css("display", "none");
                    } else {
                        return angular.element(element.find("[value='']")[0]).css("display", "");
                    }
                });
            }
        };
    });
}).call(this);

(function() {
    var app;
    app = angular.module("angleGrinder.common");
    app.directive("ieSelectFix", [ "$window", function($window) {
        return {
            "restrict": "A",
            "link": function(scope, elem, attrs, ctrl) {
                return elem.bind("change", function(event) {
                    var option, _i, _len, _results;
                    if ($window.navigator.userAgent.indexOf("MSIE 9") > 0) {
                        _results = [];
                        for (_i = 0, _len = elem.length; _i < _len; _i++) {
                            option = elem[_i];
                            _results.push(option.parentNode.insertBefore(option, option));
                        }
                        return _results;
                    }
                });
            }
        };
    } ]);
}).call(this);

(function() {
    var app;
    app = angular.module("angleGrinder.common");
    app.directive("agFileUpload", function() {
        return {
            "restrict": "A",
            "require": "ngModel",
            "link": function(scope, elem, attrs, ctrl) {
                return elem.bind("change", function(event) {
                    return scope.$apply(function(self) {
                        ctrl.$setViewValue(elem.val());
                        ctrl.$render();
                        return self[attrs.agFileUpload](event);
                    });
                });
            }
        };
    });
}).call(this);

(function() {
    var app;
    app = angular.module("angleGrinder.common");
    app.factory("embeddedJsonServ", [ "$document", function($document) {
        return function(name) {
            var node, selector, val;
            selector = "script[type='application/embedded-json'][name='" + name + "']";
            node = $(selector);
            val = void 0;
            if (node.length > 0) {
                val = angular.fromJson(node[0].innerHTML);
            }
            return val;
        };
    } ]);
}).call(this);

(function() {
    var app;
    app = angular.module("angleGrinder.common");
    app.constant("contextPath", $("body").data("contextPath"));
    app.constant("resourceTemplateServ", function(resource, path) {
        var parts;
        parts = [];
        parts.push($("body").data("contextPath"));
        parts.push(resource.replace(/^\//, ""));
        parts.push(path);
        return parts.join("/");
    });
}).call(this);

(function() {
    var app;
    app = angular.module("angleGrinder.common");
    app.directive("agSideMenu", [ "$window", "$timeout", function($window, $timeout) {
        return {
            "restrict": "A",
            "link": function(scope, element, attr) {
                var elScrollTopOriginal, headerHeight, window;
                headerHeight = 0;
                elScrollTopOriginal = 0;
                $timeout(function() {
                    var header;
                    header = angular.element(document.getElementById(attr.header));
                    elScrollTopOriginal = element.offset().top;
                    if (angular.element(header)[0] != null) {
                        return headerHeight = angular.element(header)[0].offsetHeight;
                    }
                });
                window = angular.element($window);
                return window.bind("scroll", function() {
                    if (window[0].pageYOffset > headerHeight) {
                        element.css("position", "fixed").css("top", "" + attr.offset + "px");
                    }
                    if (window[0].pageYOffset <= headerHeight) {
                        return element.css("position", "relative");
                    }
                });
            }
        };
    } ]);
}).call(this);

(function() {
    var app;
    app = angular.module("angleGrinder.common");
    app.value("requiredResourceFields", [ "id" ]);
    app.factory("restrictResource", [ "$log", "deepDiff", "resourceBuilder", "requiredResourceFields", function($log, deepDiff, resourceBuilder, requiredResourceFields) {
        return function(resource, allowedFields) {
            if (allowedFields == null) {
                allowedFields = [];
            }
            angular.extend(resource, {
                "$cacheData": function() {
                    return this.$cachedData = this.resourceData();
                },
                "$save": function() {
                    var Record, cached, record;
                    Record = resourceBuilder(this.resourcePath());
                    cached = _.cloneDeep(this.$cachedData);
                    record = new Record(deepDiff(cached, resource.resourceData(), allowedFields, requiredResourceFields));
                    record.$save();
                    this.$cachedData = _.merge(this.$cachedData, record.resourceData());
                    return this;
                },
                "save": function() {
                    var Record, record;
                    Record = resourceBuilder(this.resourcePath());
                    record = new Record(deepDiff(this.$cachedData, resource.resourceData(), allowedFields, requiredResourceFields));
                    record.save();
                    this.$cachedData = _.merge(this.$cachedData, record.resourceData());
                    return this;
                }
            });
            resource.$cacheData();
            return resource;
        };
    } ]);
}).call(this);

(function() {
    var app;
    app = angular.module("angleGrinder.common");
    app.service("deepDiff", [ "deepPick", function(deepPick) {
        var map;
        map = function(oldVal, newVal, allowed, reqFields) {
            var args, diff;
            diff = {};
            if (reqFields != null && reqFields.length > 0) {
                args = [];
                args.push(newVal);
                args = args.concat(reqFields);
                diff = deepPick.apply(this, args);
            }
            if (allowed != null && allowed.length > 0) {
                args = [];
                args.push(newVal);
                args = args.concat(allowed);
                newVal = deepPick.apply(this, args);
            }
            _.forEach(newVal, function(v, k) {
                if (oldVal != null && _.isEqual(v, oldVal[k]) || k === "$cachedData") {
                    return;
                }
                return diff[k] = _.isObject(v) ? map(oldVal[k], v) : newVal[k];
            });
            return diff;
        };
        return function(oldVal, newVal, allowed, reqFields) {
            if (allowed == null) {
                allowed = [];
            }
            if (reqFields == null) {
                reqFields = [];
            }
            return map(oldVal, newVal, allowed, reqFields);
        };
    } ]);
}).call(this);

(function() {
    var MenuCtrl, app, __hasProp = {}.hasOwnProperty, __extends = function(child, parent) {
        for (var key in parent) {
            if (__hasProp.call(parent, key)) child[key] = parent[key];
        }
        function ctor() {
            this.constructor = child;
        }
        ctor.prototype = parent.prototype;
        child.prototype = new ctor();
        child.__super__ = parent.prototype;
        return child;
    };
    app = angular.module("angleGrinder.common");
    app.directive("menuItem", [ "$route", function($route) {
        return {
            "restrict": "E",
            "transclude": true,
            "replace": true,
            "scope": true,
            "link": function(scope, element, attrs) {
                var listIcon, parent;
                scope.href = "#/" + attrs["for"];
                parent = element.parent();
                if (parent[0].attributes["list-icon"] != null) {
                    listIcon = parent[0].attributes["list-icon"].value;
                }
                scope.icon = attrs.icon || listIcon || "fa fa-circle";
                return scope.isActive = function() {
                    var _ref;
                    return ((_ref = $route.current) != null ? _ref.page : void 0) === attrs["for"];
                };
            },
            "template": '<li ng-class="{ active: isActive() }">\n  <a href="{{href}}">\n    <i class="{{icon}}"></i>\n      <span ng-transclude></span>\n    </a>\n</li>'
        };
    } ]);
    MenuCtrl = function(_super) {
        __extends(MenuCtrl, _super);
        function MenuCtrl() {
            return MenuCtrl.__super__.constructor.apply(this, arguments);
        }
        MenuCtrl.register(app, "angleGrinder.common.MenuCtrl");
        MenuCtrl.inject("$scope");
        MenuCtrl.prototype.initialize = function() {
            this.status = {};
            return this.$scope.$on("$routeChangeSuccess", function(_this) {
                return function(event, currentRoute) {
                    return _this.status[currentRoute.section] = true;
                };
            }(this));
        };
        return MenuCtrl;
    }(BaseCtrl);
}).call(this);