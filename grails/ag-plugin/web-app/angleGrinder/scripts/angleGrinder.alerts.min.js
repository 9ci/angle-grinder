(function() {
    var Alerts, alerts;
    alerts = angular.module("angleGrinder.alerts", []);
    alerts.value("alertTimeout", 3e3);
    Alerts = function() {
        Alerts.$inject = [ "$log", "$timeout", "alertTimeout" ];
        function Alerts($log, $timeout, alertTimeout) {
            this.$log = $log;
            this.$timeout = $timeout;
            this.alertTimeout = alertTimeout;
            this.lastId = 0;
            this.messages = [];
        }
        Alerts.prototype.nextId = function() {
            return this.lastId += 1;
        };
        Alerts.prototype.push = function(type, text) {
            var id;
            id = this.nextId();
            this.$log.info("Alert [" + id + ", " + type + "]", text);
            this.messages.push({
                "id": id,
                "type": type,
                "text": text
            });
            this.delayedDispose(id);
            return id;
        };
        Alerts.prototype.info = function(text) {
            return this.push("info", text);
        };
        Alerts.prototype.error = function(text) {
            return this.push("error", text);
        };
        Alerts.prototype.dispose = function(id) {
            var at;
            at = _(this.messages.map(function(message) {
                return message.id;
            })).indexOf(id);
            return this.messages.splice(at, 1);
        };
        Alerts.prototype.delayedDispose = function(id) {
            var disposeTheAlert;
            if (this.alertTimeout != null && this.alertTimeout > 0) {
                disposeTheAlert = function(_this) {
                    return function() {
                        _this.$log.info("Disposing alert", id, "after", _this.alertTimeout, "milliseconds");
                        return _this.dispose(id);
                    };
                }(this);
                return this.$timeout(disposeTheAlert, this.alertTimeout);
            }
        };
        return Alerts;
    }();
    alerts.service("alerts", Alerts);
    alerts.controller("alerts", [ "$scope", "alerts", function($scope, alerts) {
        $scope.alertMessages = alerts.messages;
        return $scope.disposeAlert = function(id) {
            return alerts.dispose(id);
        };
    } ]);
    alerts.directive("agAlerts", function() {
        return {
            "restrict": "E",
            "replace": true,
            "template": '<aside id="alerts">\n  <div ng-repeat="message in alertMessages" class="alert alert-{{message.type}}">\n    <button ng-click="disposeAlert(message.id)" type="button" class="close">\xd7</button>\n    <strong>{{message.type}}</strong> <span>{{message.text}}</span>\n  </div>\n</aside>',
            "controller": "alerts"
        };
    });
}).call(this);